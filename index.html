<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instituto de Biología Molecular</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom Styles & Tailwind Config -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Custom styles for active states */
        .nav-link-active {
            color: #10B981; /* Emerald-500 */
            font-weight: 600;
        }
        [data-lang-content] { display: none; }
        [data-page-content] { display: none; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-primary': '#0D47A1', // Dark Blue
                        'brand-secondary': '#10B981', // Emerald Green
                        'brand-light': '#F0F9FF', // Light Blue Sky
                        'brand-dark': '#1E293B', // Slate 800
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-brand-dark text-gray-300">

    <!-- =========== HEADER =========== -->
    <header class="bg-slate-900/80 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <!-- Logo -->
                <a href="#/es/" class="nav-link flex-shrink-0 flex items-center space-x-2">
                    <svg class="h-8 w-8 text-brand-secondary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.79-2.731 9.566M12 11A4.5 4.5 0 007.5 6.5M12 11V3m0 8a2.25 2.25 0 00-2.25 2.25M12 11a2.25 2.25 0 012.25 2.25m0 0A4.492 4.492 0 0116.5 20.25M12 11a9 9 0 01-9-9" />
                    </svg>
                    <span class="text-xl font-bold text-white hidden sm:block">
                        <span data-lang-content="es">Inst. Biología Molecular</span>
                        <span data-lang-content="en">Molecular Biology Inst.</span>
                    </span>
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex items-center space-x-6" id="desktop-nav">
                    <!-- Nav links will be injected by JS -->
                </nav>

                <!-- Right Side Actions -->
                <div class="flex items-center space-x-4">
                    <!-- Language Switcher -->
                    <div id="lang-switcher" class="text-sm font-medium">
                        <a href="#" data-lang="es" class="lang-link p-1 rounded">ES</a>
                        <span class="text-gray-500">|</span>
                        <a href="#" data-lang="en" class="lang-link p-1 rounded">EN</a>
                    </div>
                    <!-- Search Icon -->
                    <button class="text-gray-400 hover:text-white transition">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    </button>
                    <!-- Intranet Button -->
                    <a href="#/es/intranet" class="nav-link bg-brand-primary hover:bg-blue-800 text-white text-sm font-semibold px-4 py-2 rounded-full transition hidden sm:block">
                        Intranet
                    </a>
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" class="lg:hidden text-gray-400 hover:text-white transition">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobile-menu" class="lg:hidden hidden bg-slate-800">
            <nav class="px-4 pt-2 pb-4 space-y-2" id="mobile-nav">
                <!-- Mobile nav links will be injected by JS -->
            </nav>
            <div class="px-4 pb-4">
                 <a href="#/es/intranet" class="nav-link block text-center w-full bg-brand-primary hover:bg-blue-800 text-white text-sm font-semibold px-4 py-2 rounded-full transition">
                    Intranet
                </a>
            </div>
        </div>
    </header>

    <!-- =========== MAIN CONTENT =========== -->
    <main id="main-content" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        <!-- Page content will be injected by JS -->
    </main>

    <!-- =========== FOOTER =========== -->
    <footer class="bg-slate-900 border-t border-slate-800">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- About -->
                <div class="col-span-1 md:col-span-2">
                    <h3 class="text-lg font-semibold text-white">
                        <span data-lang-content="es">Instituto de Biología Molecular</span>
                        <span data-lang-content="en">Molecular Biology Institute</span>
                    </h3>
                    <p class="mt-2 text-sm text-gray-400">
                        <span data-lang-content="es">Avenida de la Ciencia 123, La Paz, Bolivia</span>
                        <span data-lang-content="en">123 Science Avenue, La Paz, Bolivia</span>
                    </p>
                    <p class="mt-1 text-sm text-gray-400">(+591) 2-278XXXX | info@ibm.edu.bo</p>
                </div>
                <!-- Quick Links -->
                <div>
                    <h4 class="text-sm font-semibold text-gray-200 uppercase tracking-wider">
                        <span data-lang-content="es">Enlaces Rápidos</span>
                        <span data-lang-content="en">Quick Links</span>
                    </h4>
                    <ul class="mt-4 space-y-2">
                        <li><a href="#" class="text-sm text-gray-400 hover:text-brand-secondary transition"><span data-lang-content="es">Aviso Legal</span><span data-lang-content="en">Legal Notice</span></a></li>
                        <li><a href="#" class="text-sm text-gray-400 hover:text-brand-secondary transition"><span data-lang-content="es">Política de Privacidad</span><span data-lang-content="en">Privacy Policy</span></a></li>
                        <li><a href="#/es/" class="nav-link text-sm text-gray-400 hover:text-brand-secondary transition"><span data-lang-content="es">Mapa del Sitio</span><span data-lang-content="en">Sitemap</span></a></li>
                    </ul>
                </div>
                <!-- Social -->
                <div>
                    <h4 class="text-sm font-semibold text-gray-200 uppercase tracking-wider">
                        <span data-lang-content="es">Síguenos</span>
                        <span data-lang-content="en">Follow Us</span>
                    </h4>
                    <div class="flex mt-4 space-x-4">
                        <a href="#" class="text-gray-400 hover:text-brand-secondary transition">
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M..."></path></svg> <!-- Placeholder for Twitter icon -->
                        </a>
                        <a href="#" class="text-gray-400 hover:text-brand-secondary transition">
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M..."></path></svg> <!-- Placeholder for LinkedIn icon -->
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-8 border-t border-slate-800 pt-8 text-center text-sm text-gray-500">
                <p>&copy; <span id="footer-year"></span> Instituto de Biología Molecular. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>


    <!-- =========== PAGE TEMPLATES (Hidden by default) =========== -->
    <div id="page-templates" class="hidden">
        
        <!-- 1. Inicio (Home) -->
        <div id="inicio-content">
            <!-- Hero Section -->
            <section class="text-center bg-brand-primary/20 rounded-lg p-8 md:p-16">
                <h1 class="text-4xl md:text-6xl font-bold text-white tracking-tight">
                    <span data-lang-content="es">Explorando las fronteras de la vida</span>
                    <span data-lang-content="en">Exploring the frontiers of life</span>
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-300">
                    <span data-lang-content="es">Investigación de vanguardia en biología molecular para un futuro más saludable.</span>
                    <span data-lang-content="en">Cutting-edge research in molecular biology for a healthier future.</span>
                </p>
            </section>

            <!-- Unidades Destacadas -->
            <section class="mt-16">
                <h2 class="text-3xl font-bold text-white text-center">
                    <span data-lang-content="es">Unidades de Investigación</span>
                    <span data-lang-content="en">Research Units</span>
                </h2>
                <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Unit Card -->
                    <div class="bg-slate-800 rounded-lg p-6 text-center hover:bg-slate-700/50 transition transform hover:-translate-y-1">
                        <div class="text-brand-secondary text-4xl mb-3">🧬</div>
                        <h3 class="text-xl font-semibold text-white">
                            <span data-lang-content="es">Genómica y Bioinformática</span>
                            <span data-lang-content="en">Genomics & Bioinformatics</span>
                        </h3>
                        <a href="#/es/unidades" class="nav-link mt-4 text-brand-secondary font-semibold"><span data-lang-content="es">Saber más</span><span data-lang-content="en">Learn more</span> &rarr;</a>
                    </div>
                    <!-- Repeat for other units... -->
                    <div class="bg-slate-800 rounded-lg p-6 text-center hover:bg-slate-700/50 transition transform hover:-translate-y-1">
                        <div class="text-brand-secondary text-4xl mb-3">🔬</div>
                        <h3 class="text-xl font-semibold text-white">
                            <span data-lang-content="es">Biología Celular y Cáncer</span>
                            <span data-lang-content="en">Cell Biology & Cancer</span>
                        </h3>
                        <a href="#/es/unidades" class="nav-link mt-4 text-brand-secondary font-semibold"><span data-lang-content="es">Saber más</span><span data-lang-content="en">Learn more</span> &rarr;</a>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-6 text-center hover:bg-slate-700/50 transition transform hover:-translate-y-1">
                        <div class="text-brand-secondary text-4xl mb-3">🌿</div>
                        <h3 class="text-xl font-semibold text-white">
                            <span data-lang-content="es">Biotecnología Vegetal</span>
                            <span data-lang-content="en">Plant Biotechnology</span>
                        </h3>
                        <a href="#/es/unidades" class="nav-link mt-4 text-brand-secondary font-semibold"><span data-lang-content="es">Saber más</span><span data-lang-content="en">Learn more</span> &rarr;</a>
                    </div>
                </div>
            </section>
            
            <!-- Últimas Noticias y Eventos -->
            <section class="mt-16 grid grid-cols-1 lg:grid-cols-3 gap-12">
                <div class="lg:col-span-2">
                    <h2 class="text-3xl font-bold text-white">
                        <span data-lang-content="es">Últimas Noticias</span>
                        <span data-lang-content="en">Latest News</span>
                    </h2>
                     <div class="mt-6 space-y-6">
                        <!-- News Item -->
                        <div class="bg-slate-800 rounded-lg p-4 flex space-x-4">
                            <img src="https://placehold.co/100x100/1E293B/94A3B8?text=Noticia" class="w-24 h-24 object-cover rounded-md flex-shrink-0" alt="Imagen de noticia" onerror="this.onerror=null;this.src='https://placehold.co/100x100/1E293B/94A3B8?text=Error';">
                            <div>
                                <p class="text-sm text-gray-400">15 Junio, 2025</p>
                                <h3 class="font-semibold text-white mt-1 hover:text-brand-secondary"><a href="#/es/publicaciones" class="nav-link"><span data-lang-content="es">Descubrimiento clave en la regulación génica del Chagas</span><span data-lang-content="en">Key discovery in Chagas gene regulation</span></a></h3>
                            </div>
                        </div>
                        <!-- More news... -->
                     </div>
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-white">
                        <span data-lang-content="es">Próximos Eventos</span>
                        <span data-lang-content="en">Upcoming Events</span>
                    </h2>
                     <div class="mt-6 space-y-4">
                        <!-- Event Item -->
                        <div class="bg-slate-800 rounded-lg p-4">
                            <p class="text-sm font-semibold text-brand-secondary">30 JUN 2025</p>
                             <h3 class="font-semibold text-white mt-1"><a href="#/es/eventos" class="nav-link"><span data-lang-content="es">Seminario: CRISPR-Cas9</span><span data-lang-content="en">Seminar: CRISPR-Cas9</span></a></h3>
                        </div>
                         <!-- More events... -->
                     </div>
                </div>
            </section>
        </div>

        <!-- 2. Sobre (About) -->
        <div id="sobre-content">
             <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Sobre el Instituto</span><span data-lang-content="en">About the Institute</span></h1>
             <p class="mt-4 text-lg text-gray-300">
                <span data-lang-content="es">Dedicados a la excelencia científica y a la formación de la próxima generación de investigadores.</span>
                <span data-lang-content="en">Dedicated to scientific excellence and training the next generation of researchers.</span>
            </p>
        </div>

        <!-- 3. Unidades (Units) -->
        <div id="unidades-content">
            <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Unidades de Investigación</span><span data-lang-content="en">Research Units</span></h1>
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Unit Card -->
                <div class="bg-slate-800 rounded-lg overflow-hidden group">
                    <img src="https://placehold.co/600x400/0D47A1/FFFFFF?text=Gen%C3%B3mica" class="w-full h-48 object-cover group-hover:opacity-80 transition" alt="Imagen de Genómica" onerror="this.onerror=null;this.src='https://placehold.co/600x400/0D47A1/FFFFFF?text=Error';">
                    <div class="p-5">
                        <h3 class="text-xl font-bold text-white"><span data-lang-content="es">Genómica y Bioinformática</span><span data-lang-content="en">Genomics & Bioinformatics</span></h3>
                        <p class="text-sm text-gray-400 mt-2"><span data-lang-content="es">Análisis de datos genómicos a gran escala.</span><span data-lang-content="en">Large-scale analysis of genomic data.</span></p>
                    </div>
                </div>
                <!-- Add more unit cards... -->
            </div>
        </div>
        
        <!-- 4. Proyectos (Projects) -->
        <div id="proyectos-content">
            <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Proyectos</span><span data-lang-content="en">Projects</span></h1>
        </div>

        <!-- 5. Publicaciones (Publications) -->
        <div id="publicaciones-content">
            <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Publicaciones</span><span data-lang-content="en">Publications</span></h1>
        </div>
        
        <!-- 6. Personas (People) -->
        <div id="personas-content">
            <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Nuestro Equipo</span><span data-lang-content="en">Our Team</span></h1>
             <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                 <a href="#/es/personas/investigadores" class="nav-link block p-8 bg-slate-800 rounded-lg hover:bg-brand-primary transition">
                    <h2 class="text-2xl font-bold text-white"><span data-lang-content="es">Investigadores</span><span data-lang-content="en">Researchers</span></h2>
                 </a>
                  <a href="#/es/personas/estudiantes" class="nav-link block p-8 bg-slate-800 rounded-lg hover:bg-brand-primary transition">
                    <h2 class="text-2xl font-bold text-white"><span data-lang-content="es">Estudiantes</span><span data-lang-content="en">Students</span></h2>
                 </a>
                  <a href="#/es/personas/alumni" class="nav-link block p-8 bg-slate-800 rounded-lg hover:bg-brand-primary transition">
                    <h2 class="text-2xl font-bold text-white">Alumni</h2>
                 </a>
             </div>
        </div>
        
        <!-- 6.1. Investigadores -->
        <div id="investigadores-content">
            <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Investigadores</span><span data-lang-content="en">Researchers</span></h1>
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Researcher Card -->
                <div class="bg-slate-800 rounded-lg p-5 text-center">
                    <img src="https://placehold.co/200x200/10B981/FFFFFF?text=Dra.+A" class="w-32 h-32 rounded-full mx-auto object-cover" alt="Foto de investigadora" onerror="this.onerror=null;this.src='https://placehold.co/200x200/10B981/FFFFFF?text=Error';">
                    <h3 class="text-lg font-bold text-white mt-4">Dra. Ana Quispe</h3>
                    <p class="text-brand-secondary text-sm font-medium">Investigadora Principal</p>
                    <p class="text-xs text-gray-400 mt-1">ana.quispe@ibm.edu.bo</p>
                </div>
                <!-- Add more researcher cards... -->
            </div>
        </div>

        <!-- 7. Eventos (Events) -->
        <div id="eventos-content">
            <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Eventos</span><span data-lang-content="en">Events</span></h1>
        </div>
        
        <!-- 9. Contacto (Contact) -->
        <div id="contacto-content">
            <h1 class="text-4xl font-bold text-white"><span data-lang-content="es">Contacto</span><span data-lang-content="en">Contact</span></h1>
        </div>

        <!-- 10. Intranet -->
        <div id="intranet-content">
             <div class="max-w-md mx-auto text-center bg-slate-800 p-8 rounded-lg">
                <h1 class="text-3xl font-bold text-white">Intranet</h1>
                <p class="mt-2 text-gray-400">
                    <span data-lang-content="es">Acceso exclusivo para miembros del instituto.</span>
                    <span data-lang-content="en">Exclusive access for institute members.</span>
                </p>
                <button class="mt-6 w-full flex items-center justify-center bg-white text-gray-700 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-100 transition">
                    <img src="https://www.google.com/favicon.ico" class="h-6 w-6 mr-3" alt="Google logo" onerror="this.onerror=null;this.src='https://placehold.co/24x24/FFFFFF/000000?text=G';">
                    <span data-lang-content="es">Iniciar sesión con Google</span>
                    <span data-lang-content="en">Sign in with Google</span>
                </button>
                <p class="mt-4 text-xs text-gray-500">
                    <span data-lang-content="es">Usa tu cuenta @...edu.bo</span>
                    <span data-lang-content="en">Use your @...edu.bo account</span>
                </p>
             </div>
        </div>

        <!-- Fallback for Not Found -->
        <div id="notfound-content">
            <div class="text-center py-16">
                <h1 class="text-6xl font-bold text-white">404</h1>
                <p class="text-2xl text-gray-300 mt-4">
                    <span data-lang-content="es">Página no encontrada</span>
                    <span data-lang-content="en">Page Not Found</span>
                </p>
                 <a href="#/es/" class="nav-link mt-8 inline-block bg-brand-secondary text-white font-bold py-3 px-6 rounded-full transition">
                     <span data-lang-content="es">Volver al Inicio</span>
                     <span data-lang-content="en">Return to Home</span>
                 </a>
            </div>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- CONFIGURATION ---
        const sitemap = [
            { id: 'inicio', path: '/', es: 'Inicio', en: 'Home', template: 'inicio-content' },
            { id: 'sobre', path: '/sobre', es: 'Sobre Nosotros', en: 'About Us', template: 'sobre-content' },
            { id: 'unidades', path: '/unidades', es: 'Unidades', en: 'Units', template: 'unidades-content' },
            { id: 'proyectos', path: '/proyectos', es: 'Proyectos', en: 'Projects', template: 'proyectos-content' },
            { id: 'publicaciones', path: '/publicaciones', es: 'Publicaciones', en: 'Publications', template: 'publicaciones-content' },
            { id: 'personas', path: '/personas', es: 'Personas', en: 'People', template: 'personas-content', children: [
                { id: 'investigadores', path: '/personas/investigadores', es: 'Investigadores', en: 'Researchers', template: 'investigadores-content' },
                { id: 'estudiantes', path: '/personas/estudiantes', es: 'Estudiantes', en: 'Students', template: 'personas-content' },
                { id: 'alumni', path: '/personas/alumni', es: 'Alumni', en: 'Alumni', template: 'personas-content' }
            ]},
            { id: 'eventos', path: '/eventos', es: 'Eventos', en: 'Events', template: 'eventos-content' },
            { id: 'contacto', path: '/contacto', es: 'Contacto', en: 'Contact', template: 'contacto-content' },
            { id: 'intranet', path: '/intranet', es: 'Intranet', en: 'Intranet', template: 'intranet-content', isHidden: true },
        ];
        
        // --- STATE ---
        let currentLang = 'es';
        let currentPage = 'inicio';

        // --- DOM ELEMENTS ---
        const desktopNav = document.getElementById('desktop-nav');
        const mobileNav = document.getElementById('mobile-nav');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const mainContent = document.getElementById('main-content');
        const langSwitcher = document.getElementById('lang-switcher');
        
        // --- FUNCTIONS ---

        /**
         * Builds the navigation menus (desktop and mobile)
         */
        function buildNav() {
            let desktopNavHTML = '';
            let mobileNavHTML = '';
            
            sitemap.filter(item => !item.isHidden).forEach(item => {
                const linkClass = "nav-link text-gray-300 hover:text-white transition px-3 py-2 rounded-md text-sm font-medium";
                desktopNavHTML += `<a href="#/${currentLang}${item.path}" data-page="${item.id}" class="${linkClass}"><span data-lang-content="es">${item.es}</span><span data-lang-content="en">${item.en}</span></a>`;
                mobileNavHTML += `<a href="#/${currentLang}${item.path}" data-page="${item.id}" class="${linkClass} block"><span data-lang-content="es">${item.es}</span><span data-lang-content="en">${item.en}</span></a>`;
            });

            desktopNav.innerHTML = desktopNavHTML;
            mobileNav.innerHTML = mobileNavHTML;
        }
        
        /**
         * Renders the correct page content based on the current route
         */
        function renderPage() {
            // Find the page configuration from the sitemap
            let pageConfig = sitemap.find(p => p.id === currentPage);
            if (!pageConfig) { // Check sub-pages if not found in main list
                sitemap.forEach(p => {
                    if (p.children) {
                        const childPage = p.children.find(c => c.id === currentPage);
                        if (childPage) pageConfig = childPage;
                    }
                });
            }

            const templateId = pageConfig ? pageConfig.template : 'notfound-content';
            const template = document.getElementById(templateId);

            if (template) {
                mainContent.innerHTML = template.innerHTML;
            } else {
                mainContent.innerHTML = document.getElementById('notfound-content').innerHTML;
            }

            updateUI();
        }

        /**
         * Updates UI elements like language, active nav links, etc.
         */
        function updateUI() {
            // Set HTML lang attribute
            document.documentElement.lang = currentLang;

            // Show/hide language-specific content
            document.querySelectorAll('[data-lang-content]').forEach(el => {
                el.style.display = el.getAttribute('data-lang-content') === currentLang ? 'inline' : 'none';
            });
            
            // Update language switcher style
            langSwitcher.querySelectorAll('.lang-link').forEach(link => {
                link.classList.toggle('text-brand-secondary', link.dataset.lang === currentLang);
                link.classList.toggle('text-gray-400', link.dataset.lang !== currentLang);
            });

            // Update all nav links' href attributes
            document.querySelectorAll('a.nav-link').forEach(link => {
                const originalHref = link.getAttribute('href');
                if (originalHref && originalHref.includes('#/')) {
                    const parts = originalHref.split('/');
                    parts[1] = currentLang; // Update language part
                    link.href = parts.join('/');
                }
            });

            // Update active navigation link
            document.querySelectorAll('#desktop-nav a, #mobile-nav a').forEach(link => {
                link.classList.remove('nav-link-active');
                if (link.dataset.page === currentPage) {
                    link.classList.add('nav-link-active');
                }
            });

             // Update footer year
            document.getElementById('footer-year').textContent = new Date().getFullYear();
        }
        
        /**
         * Handles routing based on URL hash
         */
        function handleRouteChange() {
            const hash = window.location.hash || `#/es/`;
            const parts = hash.substring(2).split('/'); // Remove #/
            const lang = parts[0] || 'es';
            let path = '/' + (parts.slice(1).join('/') || '');
            if (path.endsWith('/') && path.length > 1) path = path.slice(0, -1);

            currentLang = ['es', 'en'].includes(lang) ? lang : 'es';

            let newPage = sitemap.find(p => p.path === path)?.id;
            if(!newPage) { // Check children
                 sitemap.forEach(p => {
                    if (p.children) {
                        const childPage = p.children.find(c => c.path === path);
                        if (childPage) newPage = childPage.id;
                    }
                });
            }
            currentPage = newPage || 'notfound';
            
            buildNav();
            renderPage();
        }

        // --- EVENT LISTENERS ---

        // Handle clicks on language switcher
        langSwitcher.addEventListener('click', (e) => {
            e.preventDefault();
            const targetLang = e.target.closest('.lang-link')?.dataset.lang;
            if (targetLang && targetLang !== currentLang) {
                // Construct the new hash, preserving the current page path
                const hashParts = window.location.hash.substring(2).split('/'); // e.g., ['es', 'sobre']
                hashParts[0] = targetLang; // Change language part -> ['en', 'sobre']
                const newHash = '#/' + hashParts.join('/'); // -> '#/en/sobre'
                
                // This will trigger the 'hashchange' event listener, which will handle all UI updates.
                window.location.hash = newHash;
            }
        });

        // Toggle mobile menu
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Close mobile menu when a link is clicked
        document.body.addEventListener('click', (e) => {
             if (e.target.closest('#mobile-nav a')) {
                mobileMenu.classList.add('hidden');
             }
        });

        // Listen for hash changes
        window.addEventListener('hashchange', handleRouteChange);

        // --- INITIALIZATION ---
        handleRouteChange(); // Initial page load
    });
    </script>
</body>
</html>
